# 3.Mybatis中的连接池与事务

### 3.1 连接池的作用:

- 避免重复的建立和释放连接资源，减少开销提升效率。

### 3.2 Mybatis中的连接池

​		mybatis主配置文件`SqlMapConfig.xml`的`<dataSource/>`标签用于配置 数据源，其`type`属性用于选取连接池。虽然数据源的配置是可选的，但如果要采用延迟加载特性，必须配置数据源。

​		由三种内建类型的数据源:type=[UNPOOLED | POOLED | JNDI] :

- `UNPOOLED`:
	- 每次请求时都重新打开和关闭连接
	- 速度稍慢，适用于队数据库连接性可用性要求不高的应用
	- 性能依赖于书库性能
	- 可配置的属性包含:`driver`、`url`、`username`、`password`、`defaultTransactionIsolationLevel(数据库默认隔离级别)`、`defaultNetworkTimeout(等待数据库操作完成的默认网络超时时间)`、也可以为数据库驱动传递属性，如:`driver.encoding=UTF`
- `POOLED`
	- 使用`池`来管理JDBC连接，避免了创建新的连接实例所需的初始化和认证时间，支持并发web应用
	- 可配置属性除了，`UNPOOLED`中可配置属性外，还包含:
		- `poolMaximumActiveConnections`：任意时间内可存在的活动连接数，默认为10
		- `poolMaxiumActiveIdleConnections`：任意时间可存在的空闲连接数
		- `poolMaximumCheckoutTime` – 在被强制返回之前，池中连接被检出（checked out）时间，默认值：20000 毫秒（即 20 秒）
		- `poolPingQuery` – 发送到数据库的侦测查询，用来检验连接是否正常工作并准备接受请求。
		- `poolPingEnabled` – 是否启用侦测查询。若开启，需要配置`poolPingQuey`为一个可执行的sql语句，默认为false
- `JNDI`:
	- 这个数据源实现是为了能在如 EJB 或应用服务器这类容器中使用，容器可以集中或在外部配置数据源，然后放置一个 JNDI 上下文的数据源引用。这种数据源配置只需要两个属性：
		- 使用服务器提供的JNDI技术来获取数据源，仅能在web或者maven的war融创使用，Tomcat服务器使用的连接池是dbcp连接池
		- `initial_context` – 这个属性用来在 InitialContext 中寻找上下文
		- `data_source` – 这是引用数据源实例位置的上下文路径。提供了 initial_context 配置时会在其返回的上下文中进行查找，没有提供时则直接在 InitialContext 中查找。